# attack_technique: T1103
- name: T1103 - AppInit DLLs
  hosts: windows
  vars_files:
   - /opt/ansible/vars.yaml
  tasks:
    - name: copy cnc.dll
      tags: always
      win_copy:
        src: /opt/ansible/files/cnc.dll
        dest: c:\temp\
    - name: copy T1103.reg
      tags: always
      win_copy:
        src: /opt/ansible/files/T1103.reg
        dest: c:\temp\
    - name: Update registry key
      tags: always
      win_command: |
        reg.exe import c:\temp\T1103.reg
    - name: sleep for 10 seconds and continue with play to check if AV removed or Not
      tags: always
      wait_for: timeout=10
      delegate_to: localhost
    - name: check if playbook was blocked
      tags: always
      debug: msg="Playbook Completed#T1103#blocked#win#"
      when: '"No task" in T1103.stdout'        
    - name: check if playbook was successfull
      tags: always
      debug: msg="Playbook Completed#T1103#passed#win#"
      when: '"cmd.exe" in T1103.stdout'
      
    - name: delete files
      tags: always
      win_file:
        path: "{{ item }}"
        state: absent
      with_items:
        - c:\temp\cnc.dll
        - c:\temp\T1103.reg
